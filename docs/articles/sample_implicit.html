<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="This vignette shows how to use tntpmetrics to sample schools, teachers, classrooms, etc. in a way that is representative of the larger population and makes sure that the selected units differ as much as possible on the characteristics of interest.
">
<title>Sampling for Common Metrics • tntpmetrics</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Sampling for Common Metrics">
<meta property="og:description" content="This vignette shows how to use tntpmetrics to sample schools, teachers, classrooms, etc. in a way that is representative of the larger population and makes sure that the selected units differ as much as possible on the characteristics of interest.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tntpmetrics</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/metric_overview.html">Overview of Creating Metrics</a>
    <a class="dropdown-item" href="../articles/teacher_expectations.html">High Expectations</a>
    <a class="dropdown-item" href="../articles/assignments.html">Grade-Appropriate Assignments</a>
    <a class="dropdown-item" href="../articles/observation_tool.html">Observations</a>
    <a class="dropdown-item" href="../articles/student_surveys.html">Student Surveys</a>
    <a class="dropdown-item" href="../articles/sample_implicit.html">Sampling for Common Metrics</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Sampling for Common Metrics</h1>
                        <h4 data-toc-skip class="author">Adam Maier</h4>
            
      
      
      <div class="d-none name"><code>sample_implicit.Rmd</code></div>
    </div>

    
    
<p>In most TNTP projects, we collect data on common metrics to understand the extent to which students, families, teachers, or others in an <em>entire</em> school, district, network, or state, have access to a valuable resource. It’s often not practical to collect all the possible data – we can’t collect every assignment students in a school receive over an entire year, we can’t observe every lesson, we can’t survey every teacher – so we gather data on the common metrics for a subset of classrooms, teachers, etc. From whom or from which classrooms data is collected is consequential; if we do not do so randomly, the common metric data might not be representative of the broader population on which we’re hoping to make inferences.</p>
<p>Yet, if we choose participants randomly, we risk getting a random sample of data that does not contain enough variation to make equity or group comparisons. For example, if we randomly choose 5 schools from a district of 100, there is a chance we randomly choose primary schools only, or get five schools that look similarly demographically. It would be better if we could randomly pick schools while at the same time maximizing the chance the schools vary on the characteristics that matter the most to us and the outcome(s) we’re measuring.</p>
<p>This is exactly what sampling with implicit stratification does, and it’s why serious educational research organizations like NCES use it often. The <code>tntpmetrics</code> package contains tools for you to easily draw your own samples with implicit stratification. This will help ensure the common metric data you collect is representative of your target population and will allow you to compare results across equity groups.</p>
<div class="section level2">
<h2 id="practice-data-cms_data">Practice data: cms_data<a class="anchor" aria-label="anchor" href="#practice-data-cms_data"></a>
</h2>
<p>To demonstrate how to apply the implicit stratification sampling functions in <code>tntpmetrics</code>, we will use school-level data on all public schools in the Charlotte-Mecklenberg School district in the 2018-2019 school year. This data, <code>cms_data</code>, has already been cleaned and processed as part of an old Academic Diagnostic contract. This cleaning includes filling in (or imputing) missing values for some newer schools with the district mean so that the data has no missingness.</p>
<p>Included in this data is a categorical variable indicating grade-levels served (Primary, Middle, High, or Other), the proportion of students receiving free or reduced-price lunch, the proportion of students of color, the state school accountability score (<code>spg_score</code>) and letter grade(<code>spg_grade</code>), and the number of enrolled students.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cms_data</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 x 7</span></span>
<span class="co">#&gt;   school_name        grade_level_cat frl_percent soc_percent spg_score spg_grade</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> EASTOVER ELEMENTA~ Primary               0.248       0.323        66 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> MCALPINE ELEMENTA~ Primary               0.229       0.348        67 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> BARNETTE ELEMENTA~ Primary               0.239       0.355        75 B        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> TRILLIUM SPRINGS ~ Primary               0.211       0.629        76 B        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> TORRENCE CREEK EL~ Primary               0.206       0.339        77 B        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> BALLANTYNE ELEMEN~ Primary               0.152       0.477        79 B        </span>
<span class="co">#&gt; <span style="color: #949494;"># ... with 1 more variable: total_students_2018 &lt;dbl&gt;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="how-does-implicit-stratification-work-its-mostly-just-sorting-data">How does implicit stratification work? It’s mostly just sorting data<a class="anchor" aria-label="anchor" href="#how-does-implicit-stratification-work-its-mostly-just-sorting-data"></a>
</h2>
<p>To learn more about the specifics of implicit stratification, read the TNTP memo “placeholder_memo_title” (link to Adam’s, potentially revised, memo). In short, we sort the by the variable(s) on which we want to ensure variation, pick a random starting spot on this sorted list, and then count every <em>k</em> rows to get all of our selected units. The number of steps <em>k</em> represents is based on how many units are sampled. For example, there are 170 schools in the CMS data set. To sample 10 schools, pick a random starting row between 1 and 17, and then count every 17th school until the end of the data. Each school picked along the way is part of the sample.</p>
<p>Importantly, because we first sorted the data on the characteristics we care about, we ensured that schools are the most spread out they could be on these variables – i.e., the sort ensures that schools at the top of the data set look different on these variables than schools on the bottom. Thus, when we walk through the data, counting every 17th school, it’s unlikely we get a sample of schools that all look the same on these characteristics. In fact, the only time this could happen is if schools in the district don’t actually vary much on the characteristics we specify.</p>
<p>To be concrete, let’s manually draw an implicitly stratified sample of 10 schools from the <code>cms_data</code>, where we want to ensure schools vary on the percent of students of color.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Sort on soc_percent</span>
<span class="va">sorted_data</span> <span class="op">&lt;-</span> <span class="va">cms_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">soc_percent</span><span class="op">)</span>

<span class="co"># Pick a random number between 1 and 17, and then count every 17 integers ten times</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">random_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">17</span>, <span class="fl">1</span><span class="op">)</span>
<span class="va">selected_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">random_start</span>, by <span class="op">=</span> <span class="fl">17</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="co"># Keep the rows corresponding to the selected rows</span>
<span class="va">implicit_sampled_data</span> <span class="op">&lt;-</span> <span class="va">sorted_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="va">selected_rows</span><span class="op">)</span></code></pre></div>
<p>Let’s see how much variability we have on <code>soc_percent</code> in our sampled data, compared to just randomly selecting 10 schools without implicit stratification.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Randomly pick 10 schools without stratification</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">nonimplicit_sampled_data</span> <span class="op">&lt;-</span> <span class="va">cms_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>

<span class="co"># Use Standard Deviation to compare variability on percent_soc</span>
<span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">implicit_sampled_data</span><span class="op">$</span><span class="va">soc_percent</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.2728191</span>
<span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">nonimplicit_sampled_data</span><span class="op">$</span><span class="va">soc_percent</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.2947937</span></code></pre></div>
<p>The standard deviation of <code>soc_percent</code> in the implicit sample is higher than in the simple random sample.</p>
<div class="section level3">
<h3 id="sorting-on-more-than-one-variable-serpentine-sorting">Sorting on more than one variable: Serpentine sorting<a class="anchor" aria-label="anchor" href="#sorting-on-more-than-one-variable-serpentine-sorting"></a>
</h3>
<p>Drawing an implicit stratified sample is easy with just one characteristic of interest. We just did it manually above! It might seem just as easy with two characteristics of interest, as we could just sort on both variables. But look what happens when we sort the <code>cms_data</code> by grade-level and proportion of students receiving FRL.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cms_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">school_name</span>, <span class="va">grade_level_cat</span>, <span class="va">frl_percent</span>, <span class="va">spg_score</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">grade_level_cat</span>, <span class="va">frl_percent</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">24</span><span class="op">:</span><span class="fl">29</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 x 4</span></span>
<span class="co">#&gt;   school_name             grade_level_cat frl_percent spg_score</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> WEST MECKLENBURG HIGH   High                 0.998         54</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> HARDING UNIVERSITY HIGH High                 0.998         52</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> GARINGER HIGH           High                 0.999         59</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> JAY M ROBINSON MIDDLE   Middle               0.099<span style="text-decoration: underline;">4</span>        92</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> SOUTH CHARLOTTE MIDDLE  Middle               0.135         86</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> COMMUNITY HOUSE MIDDLE  Middle               0.166         85</span></code></pre></div>
<p>The data is first sorted (alphabetically) on grade-level, and then within each grade-level the data is sorted in ascending order on the proportion of students receiving FRL. The code above shows where in the data it goes from high schools to middle schools. Notice how the proportion of FRL students makes a <strong>huge</strong> jump from Gariner High to Jay M Robinson Middle. Once the data gets to the next grade-level category, it must start over again from the lowest values of <code>frl_percent</code>. This leads to large differences in concurrent rows at these junctures. Though these schools already differ by grade-level, this disconnect means they’re very different on other key factors, too. Not only do they differ on their FRL proportion, but because this variable is linked to other characteristics, we see that they’re also very different on something like school achievement. These disconnected junctures in the sort are magnified if we sort by even more than two variables.</p>
<p>Instead, we want concurrent rows of the data to be as similar as possible on the characteristics of interest. This is what helps us obtain the most variability possible in our sample. To do this, we must use a sorting approach known as serpentine, where instead of always starting over with an ascending sort at each juncture, we alternate between ascending and descending sorts to ensure the juncture keeps the values as similar as possible. <code>tntpmetrics</code> has a built in function to perform serpentine sorts. Let’s apply it to the CMS data and look at the same juncture as above.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cms_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">school_name</span>, <span class="va">grade_level_cat</span>, <span class="va">frl_percent</span>, <span class="va">spg_score</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/serpentine.html">serpentine</a></span><span class="op">(</span><span class="va">grade_level_cat</span>, <span class="va">frl_percent</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">24</span><span class="op">:</span><span class="fl">29</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 x 4</span></span>
<span class="co">#&gt;   school_name             grade_level_cat frl_percent spg_score</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> WEST MECKLENBURG HIGH   High                  0.998        54</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> HARDING UNIVERSITY HIGH High                  0.998        52</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> GARINGER HIGH           High                  0.999        59</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ALBEMARLE ROAD MIDDLE   Middle                0.997        50</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> RANSON MIDDLE           Middle                0.997        42</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> MCCLINTOCK MIDDLE       Middle                0.997        55</span></code></pre></div>
<p>Now the first middle school in the list is the one with the highest proportion of students receiving FRL. The implicit stratification sample function in <code>tntpmetrics</code> uses this serpentine sort, so you do not need to use the function <code>serpentine</code> directly, though it’s available to you as part of the package if you need it for other purposes, or you need to modify the default sampling approach. It works much like <code><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">dplyr::arrange</a></code>: simply list the variables you want to serpentine sort.</p>
</div>
<div class="section level3">
<h3 id="the-order-of-sorting-variables-matters">The order of sorting variables matters<a class="anchor" aria-label="anchor" href="#the-order-of-sorting-variables-matters"></a>
</h3>
<p>Even with serpentine sorting, you will get a differently sorted list if you first sort on grade-level and then FRL percent compared to first sorting on FRL percent and then grade-level. The reasons are obvious, but it’s important to point out. In general, it’s best to first sort on the variables that are most important to you, as this will be the variable on which your data is <em>most</em> spread out. Then, choose variables in order from most to least important. If you sort on many variables, the last variables you include will have a smaller effect on the position, as much of the data order is already “locked in”.</p>
</div>
<div class="section level3">
<h3 id="making-sorts-categorical">Making sorts categorical<a class="anchor" aria-label="anchor" href="#making-sorts-categorical"></a>
</h3>
<p>What if we wanted to ensure variability on both percent FRL and SPG Score in a school? The obvious answer is to just include them both in a sort.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cms_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">school_name</span>, <span class="va">grade_level_cat</span>, <span class="va">frl_percent</span>, <span class="va">spg_score</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/serpentine.html">serpentine</a></span><span class="op">(</span><span class="va">frl_percent</span>, <span class="va">spg_score</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 x 4</span></span>
<span class="co">#&gt;    school_name                  grade_level_cat frl_percent spg_score</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> PROVIDENCE SPRING ELEMENTARY Primary              0.042<span style="text-decoration: underline;">2</span>        90</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ELON PARK ELEMENTARY         Primary              0.062<span style="text-decoration: underline;">4</span>        88</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> POLO RIDGE ELEMENTARY        Primary              0.065<span style="text-decoration: underline;">5</span>        88</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ELIZABETH LANE ELEM          Primary              0.094         83</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> JAY M ROBINSON MIDDLE        Middle               0.099<span style="text-decoration: underline;">4</span>        92</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ARDREY KELL HIGH             High                 0.103         92</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> PROVIDENCE HIGH              High                 0.104         93</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> HAWK RIDGE ELEMENTARY        Primary              0.112         86</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> PARK ROAD MONTESSORI         Primary              0.112         86</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> SOUTH CHARLOTTE MIDDLE       Middle               0.135         86</span></code></pre></div>
<p>Notice how the SPG score barely seems sorted at all. That is because the data is first sorted on FRL percent, and because this variable is nearly unique to each school: once the data is sorted on it, there is very little to no room left to sort anything else.</p>
<p>When you want to include multiple non-categorical variables in your implicit stratification, you have two options:</p>
<ol style="list-style-type: decimal">
<li>Don’t do it; just pick one non categorical variable. This approach might be worthwhile if the two variables of interest are closely related. In these cases, adding the second variable doesn’t add much to the stratification. But if the variables are not closely related and it’s not not critically important to keep one of the variables as is, your best option is to</li>
<li>Make the variables categorical. This is the more common approach as it allows you to keep both variables in the stratification process.</li>
</ol>
<p>In the CMS example, let’s turn percent FRL and percent SOC into categorical variables.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cms_data</span> <span class="op">%&lt;&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    frl_cat <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span>
      <span class="va">frl_percent</span> <span class="op">&lt;</span> <span class="fl">0.25</span> <span class="op">~</span> <span class="st">"&lt; 25%"</span>,
      <span class="va">frl_percent</span> <span class="op">&lt;</span> <span class="fl">0.50</span> <span class="op">~</span> <span class="st">"25-50%"</span>,
      <span class="va">frl_percent</span> <span class="op">&lt;</span> <span class="fl">0.75</span> <span class="op">~</span> <span class="st">"50-75%"</span>,
      <span class="va">frl_percent</span> <span class="op">&lt;=</span> <span class="fl">1.00</span> <span class="op">~</span> <span class="st">"&gt; 75%"</span>
    <span class="op">)</span>,
    frl_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">frl_cat</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt; 25%"</span>, <span class="st">"25-50%"</span>, <span class="st">"50-75%"</span>, <span class="st">"&gt; 75%"</span><span class="op">)</span><span class="op">)</span>,
    soc_cat <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span>
      <span class="va">soc_percent</span> <span class="op">&lt;</span> <span class="fl">0.25</span> <span class="op">~</span> <span class="st">"&lt; 25%"</span>,
      <span class="va">soc_percent</span> <span class="op">&lt;=</span> <span class="fl">0.50</span> <span class="op">~</span> <span class="st">"25-50%"</span>,
      <span class="va">soc_percent</span> <span class="op">&lt;=</span> <span class="fl">0.75</span> <span class="op">~</span> <span class="st">"50-75%"</span>,
      <span class="va">soc_percent</span> <span class="op">&lt;=</span> <span class="fl">1.00</span> <span class="op">~</span> <span class="st">"&gt; 75%"</span>
    <span class="op">)</span>,
    soc_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">soc_cat</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"&lt; 25%"</span>, <span class="st">"25-50%"</span>, <span class="st">"50-75%"</span>, <span class="st">"&gt; 75%"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p>We can then try the sort again.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cms_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">school_name</span>, <span class="va">grade_level_cat</span>, <span class="va">frl_cat</span>, <span class="va">spg_score</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/serpentine.html">serpentine</a></span><span class="op">(</span><span class="va">frl_cat</span>, <span class="va">spg_score</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 x 4</span></span>
<span class="co">#&gt;    school_name                 grade_level_cat frl_cat spg_score</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> EASTOVER ELEMENTARY         Primary         &lt; 25%          66</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> MCALPINE ELEMENTARY         Primary         &lt; 25%          67</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> BARNETTE ELEMENTARY         Primary         &lt; 25%          75</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> TRILLIUM SPRINGS MONTESSORI Primary         &lt; 25%          76</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> DAVIDSON ELEMENTARY         Primary         &lt; 25%          76</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> TORRENCE CREEK ELEMENTARY   Primary         &lt; 25%          77</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> SHARON ELEMENTARY           Primary         &lt; 25%          79</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> BALLANTYNE ELEMENTARY       Primary         &lt; 25%          79</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> OLDE PROVIDENCE ELEMENTARY  Primary         &lt; 25%          80</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> J.V. WASHAM ELEMENTARY      Primary         &lt; 25%          81</span></code></pre></div>
<p>There, things look better. It’s okay to implicitly stratify by a non-categorical variable, but it usually should be your last variable listed, and in most cases you should only have one of these types of variables.</p>
</div>
</div>
<div class="section level2">
<h2 id="drawing-an-implicit-sample">Drawing an implicit sample<a class="anchor" aria-label="anchor" href="#drawing-an-implicit-sample"></a>
</h2>
<p>With an understanding of how implicitly stratified sampling works, actually drawing the sample is straightforward. Use the <code>sample_implicit</code> function on your data and indicate how many rows you want sampled. You do not need to sort the data ahead of time with this function, as it contains a place to indicate the variables on which you want to implicitly stratify. After running this function, you will get your same data back (sorted appropriately) with a new variable called <code>in_sample</code> that is TRUE if the row was selected and FALSE if not.</p>
<p>For example, let’s sample 20 CMS schools after implicitly stratifying on grade-level, proportion FRL, proportion SOC, and the SPG score.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cms_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_implicit.html">sample_implicit</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">cms_data</span>,
  n <span class="op">=</span> <span class="fl">20</span>,
  <span class="va">grade_level_cat</span>, <span class="va">frl_cat</span>, <span class="va">soc_cat</span>, <span class="va">spg_score</span>
<span class="op">)</span>
<span class="va">cms_sample</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">school_name</span>, <span class="va">in_sample</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 x 2</span></span>
<span class="co">#&gt;    school_name                in_sample</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> WILLIAM AMOS HOUGH HIGH    FALSE    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> LEVINE MIDDLE COLLEGE HIGH FALSE    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> PROVIDENCE HIGH            TRUE     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ARDREY KELL HIGH           FALSE    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> OLYMPIC HIGH               FALSE    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> MALLARD CREEK HIGH         FALSE    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> CATO MIDDLE COLLEGE HIGH   FALSE    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> SOUTH MECKLENBURG HIGH     FALSE    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> BUTLER HIGH                FALSE    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> HOPEWELL HIGH              FALSE</span></code></pre></div>
<p>To get just the 20 sampled schools, you can filter on <code>in_sample</code></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cms_sample</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">in_sample</span> <span class="op">==</span> <span class="cn">T</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 x 10</span></span>
<span class="co">#&gt;    school_name       grade_level_cat frl_percent soc_percent spg_score spg_grade</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> PROVIDENCE HIGH   High                 0.104        0.275        93 A        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> MYERS PARK HIGH   High                 0.308        0.396        83 B        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> CHARLOTTE TEACHE~ High                 0.606        0.819        77 B        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> JAMES MARTIN MID~ Middle               0.987        0.962        37 F        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> NORTHRIDGE MIDDLE Middle               0.996        0.953        58 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> FRANCIS BRADLEY ~ Middle               0.352        0.471        73 B        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> BAILEY MIDDLE     Middle               0.189        0.248        87 A        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> LAWRENCE ORR ELE~ Primary              0.996        0.980        69 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> MERRY OAKS INTER~ Primary              0.973        0.979        62 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> HUNTINGTOWNE FAR~ Primary              0.987        0.914        59 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">11</span> HIDDEN VALLEY EL~ Primary              0.993        0.986        55 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">12</span> GOVERNORS VILLAG~ Primary              0.996        0.969        52 D        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">13</span> OAKDALE ELEMENTA~ Primary              0.995        0.956        46 D        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">14</span> ALLENBROOK ELEME~ Primary              0.994        0.964        36 F        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">15</span> ELIZABETH TRADIT~ Primary              0.5          0.782        70 B        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">16</span> MATTHEWS ELEMENT~ Primary              0.340        0.381        75 B        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">17</span> MYERS PARK TRADI~ Primary              0.404        0.637        70 B        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">18</span> IRWIN ACADEMIC C~ Primary              0.256        0.763        83 B        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">19</span> BAIN ELEMENTARY   Primary              0.226        0.299        83 B        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">20</span> PROVIDENCE SPRIN~ Primary              0.042<span style="text-decoration: underline;">2</span>       0.301        90 A        </span>
<span class="co">#&gt; <span style="color: #949494;"># ... with 4 more variables: total_students_2018 &lt;dbl&gt;, frl_cat &lt;ord&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   soc_cat &lt;ord&gt;, in_sample &lt;lgl&gt;</span></span></code></pre></div>
<p>This makes comparing sampled schools to non-sampled schools easy.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cms_sample</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">in_sample</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>mean_frl<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">frl_percent</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 x 2</span></span>
<span class="co">#&gt;   in_sample mean_frl</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> FALSE        0.647</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> TRUE         0.612</span></code></pre></div>
<div class="section level3">
<h3 id="accounting-for-size-differences">Accounting for size differences<a class="anchor" aria-label="anchor" href="#accounting-for-size-differences"></a>
</h3>
<p>The implicit stratification approach outlined above treats each row of data equally. In many cases, that makes sense, for example if each row was a teacher or a classroom. However, in some cases each row of data might represent a substantially different number of subunits, like classrooms or students. This is often the case when sampling schools. Treating each school equally means that students in small schools are more likely to be studied than students in large schools because the former’s school is equally likely to be chosen as the latter, but once the school is chosen students in small schools are more likely to have one of their classrooms visited given the fewer options there.</p>
<p><code>sample_implicit</code> includes an option to specify a variable in your data representing a measure of size. It will then account for this size and choose schools with a probability proportional to its size.</p>
<p>In the CMS data, we can use the total number of students in the schools as a measure of size and account for this when we draw the sample</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cms_sample_withsize</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_implicit.html">sample_implicit</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">cms_data</span>,
  n <span class="op">=</span> <span class="fl">20</span>,
  <span class="va">grade_level_cat</span>, <span class="va">frl_cat</span>, <span class="va">soc_cat</span>, <span class="va">spg_score</span>,
  size_var <span class="op">=</span> <span class="va">total_students_2018</span>
<span class="op">)</span>
<span class="va">cms_sample_withsize</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">in_sample</span> <span class="op">==</span> <span class="cn">T</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 x 10</span></span>
<span class="co">#&gt;    school_name       grade_level_cat frl_percent soc_percent spg_score spg_grade</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> LEVINE MIDDLE CO~ High                 0.205        0.426        99 A        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> SOUTH MECKLENBUR~ High                 0.432        0.615        79 B        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> PERFORMANCE LEAR~ High                 0.609        0.742        45 D        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> VANCE HIGH        High                 0.990        0.966        61 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> JAMES MARTIN MID~ Middle               0.987        0.962        37 F        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> MCCLINTOCK MIDDLE Middle               0.997        0.882        55 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ALEXANDER GRAHAM~ Middle               0.309        0.404        68 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> SOUTH CHARLOTTE ~ Middle               0.135        0.294        86 A        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> COCHRANE COLLEGI~ Other                0.996        0.978        38 F        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> JOSEPH W GRIER A~ Primary              0.999        0.958        64 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">11</span> RIVER OAKS ACADE~ Primary              0.995        0.873        59 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">12</span> J H GUNN ELEMENT~ Primary              0.996        0.895        56 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">13</span> GOVERNORS VILLAG~ Primary              0.996        0.969        52 D        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">14</span> HORNETS NEST ELE~ Primary              0.995        0.970        46 D        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">15</span> VAUGHAN ACADEMY ~ Primary              0.606        0.819        59 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">16</span> LONG CREEK ELEME~ Primary              0.530        0.728        62 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">17</span> ENDHAVEN ELEMENT~ Primary              0.286        0.503        75 B        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">18</span> MALLARD CREEK EL~ Primary              0.479        0.899        59 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">19</span> ELIZABETH LANE E~ Primary              0.094        0.27         83 B        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">20</span> PROVIDENCE SPRIN~ Primary              0.042<span style="text-decoration: underline;">2</span>       0.301        90 A        </span>
<span class="co">#&gt; <span style="color: #949494;"># ... with 4 more variables: total_students_2018 &lt;dbl&gt;, frl_cat &lt;ord&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   soc_cat &lt;ord&gt;, in_sample &lt;lgl&gt;</span></span></code></pre></div>
<p>Notice how incorporating size increased the number of secondary schools in the sample. Because these schools typically contain more students, including size increased the chance they’d be chosen.</p>
</div>
</div>
<div class="section level2">
<h2 id="other-sampling-approaches">Other sampling approaches<a class="anchor" aria-label="anchor" href="#other-sampling-approaches"></a>
</h2>
<p>Implicit stratified sampling is not the only technique. But rather than create functions to account for all sampling situations, many other approaches can be accomplished with existing R functions and packages, or by combining them with <code>sample_implicit</code>.</p>
<div class="section level3">
<h3 id="simple-random-sampling">Simple random sampling<a class="anchor" aria-label="anchor" href="#simple-random-sampling"></a>
</h3>
<p>If you don’t need or want to select a stratified sample, it’s easiest to use already available functions. For a simple random sample – i.e., the equivalent of throwing each row of data into a hat and selecting <code>n</code> of them at random – I recommend <code>sample_n</code> from <code>dplyr</code>. This is the approach used earlier in the vignette to choose 10 random schools</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">cms_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 x 9</span></span>
<span class="co">#&gt;    school_name       grade_level_cat frl_percent soc_percent spg_score spg_grade</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> MALLARD CREEK HI~ High                  0.455       0.843        75 B        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> PARK ROAD MONTES~ Primary               0.112       0.319        86 A        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> REEDY CREEK ELEM~ Primary               0.721       0.910        63 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ALBEMARLE ROAD M~ Middle                0.997       0.936        50 D        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> HUNTERSVILLE ELE~ Primary               0.305       0.349        83 B        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> CHARLOTTE ENGINE~ Other                 0.454       0.784        83 B        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> COCHRANE COLLEGI~ Other                 0.996       0.978        38 F        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> PERFORMANCE LEAR~ High                  0.609       0.742        45 D        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> NATIONS FORD ELE~ Primary               0.996       0.979        59 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> RIVER OAKS ACADE~ Primary               0.995       0.873        59 C        </span>
<span class="co">#&gt; <span style="color: #949494;"># ... with 3 more variables: total_students_2018 &lt;dbl&gt;, frl_cat &lt;ord&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   soc_cat &lt;ord&gt;</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="explicitly-stratifying">Explicitly stratifying<a class="anchor" aria-label="anchor" href="#explicitly-stratifying"></a>
</h3>
<p>Explicitly stratifying a sample typically means selecting a fixed number of units for explicit groups (or strata). For example, if I wanted to ensure I selected 3 schools of each grade-level type, I’d first split the data by grade-type, then randomly select schools in each group. Again, it’s easiest to implement this with already available tools: by combining <code>sample_n</code> and <code>group_by</code> from dplyr.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">cms_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">grade_level_cat</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 x 9</span></span>
<span class="co">#&gt; <span style="color: #949494;"># Groups:   grade_level_cat [4]</span></span>
<span class="co">#&gt;    school_name       grade_level_cat frl_percent soc_percent spg_score spg_grade</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> NORTH MECKLENBUR~ High                  0.536       0.821        61 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> MALLARD CREEK HI~ High                  0.455       0.843        75 B        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ROCKY RIVER HIGH  High                  0.636       0.923        53 D        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> EASTWAY MIDDLE    Middle                0.997       0.962        40 D        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> MCCLINTOCK MIDDLE Middle                0.997       0.882        55 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> SOUTHWEST MIDDLE~ Middle                0.545       0.770        49 D        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> HAWTHORNE ACADEM~ Other                 0.974       0.926        52 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> CHARLOTTE ENGINE~ Other                 0.454       0.784        83 B        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> COCHRANE COLLEGI~ Other                 0.996       0.978        38 F        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> PARK ROAD MONTES~ Primary               0.112       0.319        86 A        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">11</span> MOUNTAIN ISLAND ~ Primary               0.584       0.718        59 C        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">12</span> NATIONS FORD ELE~ Primary               0.996       0.979        59 C        </span>
<span class="co">#&gt; <span style="color: #949494;"># ... with 3 more variables: total_students_2018 &lt;dbl&gt;, frl_cat &lt;ord&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   soc_cat &lt;ord&gt;</span></span></code></pre></div>
<p>This approach guarantees a specific number of schools for each strata. This differs from implicitly stratifying, where one will get a sample that have units (e.g., schools) from the different strata, but there is no preordained or set number of units selected from each strata - in fact, if some strata contains few units then there there is a chance zero units from some strata will be chosen. Explicitly stratifying the data ensures each stratum is represented. This could be good or bad: if you force a unit to be chosen from each stratum, then the data may no longer be representative if the strata vary wildly in size. One would need to apply weights to the collected data to get back to representative values, which is a process seldom used at TNTP. At the same time, forcing a unit to be chosen from each stratum ensures no group is excluded, even if the data taken together is no longer representative of the overall population. Which approach to use depends on the needs of the project. If you’re looking to get data that is representative of an entire school, district, network, etc. implicitly stratifying the data will likely get you there more easily.</p>
</div>
<div class="section level3">
<h3 id="combining-explicit-and-implicit-stratification-using-purrrmap">Combining explicit and implicit stratification using <code>purrr::map</code><a class="anchor" aria-label="anchor" href="#combining-explicit-and-implicit-stratification-using-purrrmap"></a>
</h3>
<p>Using existing functions, we can also combine explicit and implicit stratification. For example, what if we wanted three schools from each grade-level type, but within each grade-level we did not want to pick schools randomly; instead we wanted to implicitly stratify on the proportion of students receiving FRL and the SPG score. We can combine both stratification approaches with the help of the <code>map</code> function from the <code>purrr</code> package.</p>
<p>To implement, we split the data by grade-level type, then apply the <code>sample_implicit</code> function separately to each grade-type. We’ll use the <code>map_df</code> function to combine the results back into a single data.frame all in one step.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org" class="external-link">purrr</a></span><span class="op">)</span>
<span class="va">cms_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">grade_level_cat</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_df</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="../reference/sample_implicit.html">sample_implicit</a></span><span class="op">(</span><span class="va">.x</span>, n <span class="op">=</span> <span class="fl">3</span>, <span class="va">frl_cat</span>, <span class="va">spg_score</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">in_sample</span><span class="op">)</span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">school_name</span>, <span class="va">grade_level_cat</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 x 2</span></span>
<span class="co">#&gt;    school_name                              grade_level_cat</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> PROVIDENCE HIGH                          High           </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> HOPEWELL HIGH                            High           </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> CHARLOTTE TEACHER EARLY COLLEGE- UNCC    High           </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> SOUTH CHARLOTTE MIDDLE                   Middle         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> J M ALEXANDER MIDDLE                     Middle         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> NORTHEAST MIDDLE                         Middle         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> CHARLOTTE ENGINEERING EARLY COLLEGE-UNCC Other          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> NORTHWEST SCHOOL OF THE ARTS             Other          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> COCHRANE COLLEGIATE ACADEMY              Other          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> J.V. WASHAM ELEMENTARY                   Primary        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">11</span> REEDY CREEK ELEMENTARY                   Primary        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">12</span> HIGHLAND RENAISSANCE ACADEMY             Primary</span></code></pre></div>
<p>Instead of selecting the same number of schools for each grade-level, we can instead vary how many schools are chosen by providing the map function additional information. In this case, we’ll use <code>map2_df</code> so that we can tell it to use for the value of <code>n</code> the corresponding element in a list we give it. In the example below, we want to select 2 high schools, 3 middle schools, 4 primary schools, and 1 “other” school.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cms_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">grade_level_cat</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2_df</a></span><span class="op">(</span>
    .x <span class="op">=</span> <span class="va">.</span>,
    .y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"High"</span> <span class="op">=</span> <span class="fl">2</span>, <span class="st">"Middle"</span> <span class="op">=</span> <span class="fl">3</span>, <span class="st">"Other"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"Primary"</span> <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,
    .f <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/sample_implicit.html">sample_implicit</a></span><span class="op">(</span><span class="va">.x</span>, n <span class="op">=</span> <span class="va">.y</span>, <span class="va">frl_cat</span>, <span class="va">spg_score</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">in_sample</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">school_name</span>, <span class="va">grade_level_cat</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 x 2</span></span>
<span class="co">#&gt;    school_name                  grade_level_cat</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> LEVINE MIDDLE COLLEGE HIGH   High           </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> INDEPENDENCE HIGH            High           </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> SOUTH CHARLOTTE MIDDLE       Middle         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> J M ALEXANDER MIDDLE         Middle         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> NORTHEAST MIDDLE             Middle         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> NORTHWEST SCHOOL OF THE ARTS Other          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> BALLANTYNE ELEMENTARY        Primary        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> PARKSIDE ELEMENTARY          Primary        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ALBEMARLE ROAD ELEMENTARY    Primary        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> DAVID COX ROAD ELEMENTARY    Primary</span></code></pre></div>
<p>There above examples assume a familiarity with <code>purrr</code> and indeed there are other ways to use <code>sample_implicit</code> with other existing R functions to meet your needs. The point is to simply highlight how you can build upon <code>sample_implicit</code> to accomplish your sampling goals.</p>
</div>
</div>
<div class="section level2">
<h2 id="questions">Questions?<a class="anchor" aria-label="anchor" href="#questions"></a>
</h2>
<p>Contact Adam Maier with questions.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Adam Maier, Shane Orr.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
